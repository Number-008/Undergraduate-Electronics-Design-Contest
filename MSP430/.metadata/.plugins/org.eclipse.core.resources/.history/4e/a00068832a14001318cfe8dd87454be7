/*
 * ad9854.c
 *
 *  Created on: 2013-9-3
 *      Author: 覃海程
 */
#include "msp430G2553.h"
#include "spi.h"
#include "ad9854.h"


void DelayMs (unsigned int ms)
{
	__delay_cycles(1000*ms);//1M主时钟时
}

//******************************************************************************

unsigned char AD9854_Reg_PHA1[2]	={0x00,0x00};
unsigned char AD9854_Reg_PHA2[2]	={0x00,0x00};
unsigned char AD9854_Reg_FRE1[6]	={0x00,0xF0,0x00,0x00,0x00,0x00};
unsigned char AD9854_Reg_FRE2[6]	={0x50,0x00,0x00,0x00,0x00,0x00};
unsigned char AD9854_Reg_DELTA[6]	={0x00,0x00,0x00,0x01,0x00,0x00};
unsigned char AD9854_Reg_UPDATA[4]	={0x00,0x00,0x00,0x00};
unsigned char AD9854_Reg_RAMP_CLK[3]={0x00,0x00,0x01};
unsigned char AD9854_Reg_CTR_REG[4]	={	Bin(00010000),       //comp pd dowm  ctr[28]=0 //qac pd down ctr[26]=0
                           				Bin(01000110),       //no pll pass ctr[21]=0  //multi times 6 ctr[19-16]=00110
			   							Bin(00100101),       //ext update ctr[8]=0    //Ramped FSK
                           				Bin(01000000) };     //pass inv CR[6]=1//osk EN ctr[5]=0 //msb first ctr[1]=0 //no sdo active ctr[0]=0
unsigned char AD9854_Reg_I_MUL[2]	={0x00,0x00};
unsigned char AD9854_Reg_Q_MUL[2]	={0x00,0x00};
unsigned char AD9854_Reg_SHAPED[1]	={0x00};
unsigned char AD9854_Reg_Q_DAC[2]	={0x00,0x00};

////////////////////////////////////////////////////////////////////
//                                                                //
//                             BASIC FUNCTION                     //
//                                                                //
////////////////////////////////////////////////////////////////////
u8 AD9854SpiSendReceive(u8 Addr,u8 dat)
{
	u8 temp;
	//SpiSetCK(0);
	AD9854_CS_DOWN;
	SpiWriteDat(Addr);
	temp=SpiWriteDat(dat);
	AD9854_CS_UP;
	return (temp);
}

//函数功能:更新设置
//输入参数:无
//******************************************************************
void Update_AD9854(void)
{
  	unsigned i=100 ;        //
	AD9854_UPDATE_OUT;
	AD9854_UPDATE_UP ;      //
	while(i--) ;
	AD9854_UPDATE_DOWN ;
}
//******************************************************************

//函数功能:复位
//输入参数:无
//******************************************************************
void Io_Reset_AD9854(void)
{
	unsigned i=100 ;        //
	AD9854_IO_RESET_UP ;
	while(i--) ;
	AD9854_IO_RESET_DOWN ;
}
//******************************************************************

//函数功能:AD9854初始化 写控制寄存器
//输入参数:无
//硬件说明：
//******************************************************************
void Init_AD9854(void)
{
	HARDWARE_AD9854 ;       //通过宏定义设置
	AD9854_OSC_ON;			//打开时钟
	AD9854_CS_DOWN ;        //片选
	AD9854_RESET_UP;
	DelayMs(10);
	AD9854_RESET_DOWN;		//主复位
	Io_Reset_AD9854();
	AD9854_OSC_OFF;			//关闭时钟，更新配置
	TI_CC_SPIWriteBurstReg(AD9854_Addr_CTR_REG,		//写控制寄存器
						AD9854_Reg_CTR_REG, AD9854_Length_CTR_REG);
	AD9854_OSC_ON;			//打开时钟，更新配置
	DelayMs(10);
	AD9854_UPDATE_OUT;
	AD9854_UPDATE_DOWN;		//配置更新时钟为输出
}

//******************************************************************
//函数功能：写 Frequency Tuning Word #1
//输入参数:
//写入地址字节数:1 Byte
//写入数据字节数:6 Bytes
//******************************************************************
void Write_AD9854_Freq(void)
{

	 Update_AD9854();

}

//******************************************************************
//函数功能：设置三角扫频
//输入参数:
//Serial Register Address :2，3，4，6
//写入地址字节数:1 Byte
//写入数据字节数:6 Bytes
//******************************************************************
void Write_AD9854_FrqSW(void)
{

	  	Update_AD9854();
}
